<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<title>Ceylan-HOWTOs: About Rust</title>
<link rel="stylesheet" href="pygments-default.css" type="text/css" />
<link rel="stylesheet" href="howtos.css" type="text/css" />
<link href="howtos-icon.png" rel="icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="document" id="rust">
<span id="top"></span>
<h1 class="title">Rust</h1>

<p><span class="raw-html"><a name="howtos_top"></a></span></p>
<p><span class="raw-html"><div class="banner"><p><em>Ceylan HOWTOs</em> <a href="http://howtos.esperide.org">browse latest</a> <a href="Ceylan-HOWTOs-english.pdf">get PDF</a> <a href="#howtos_top">go to top</a> <a href="#howtos_toc">go to toc</a> <a href="#howtos_bottom">go to bottom</a> <a href="Ceylan-HOWTOs-overview-english.html">go to HOWTOs</a> <a href="mailto:about(dash)ceylan-howtos(at)esperide(dot)com?subject=[Ceylan-HOWTOs]%20Remark%20about%20Rust">email us</a></p></div></span></p>
<p><span class="raw-html"><center><img src="howtos-title.png" id="responsive-image-ultrasmall"></img></span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Organisation:</th><td class="field-body">Copyright (C) 2024-2025 Olivier Boudeville</td>
</tr>
<tr class="field"><th class="field-name">Contact:</th><td class="field-body">about (dash) howtos (at) esperide (dot) com</td>
</tr>
<tr class="field"><th class="field-name">Creation date:</th><td class="field-body">Tuesday, March 12, 2024</td>
</tr>
<tr class="field"><th class="field-name">Lastly updated:</th><td class="field-body">Friday, February 7, 2025</td>
</tr>
</tbody>
</table>
<p><span class="raw-html"><a name="howtos_toc"></a></span></p>
<div class="contents local topic" id="topic-1">
<span id="table-of-contents"></span><p class="topic-title"><a class="reference internal" href="#top"><strong>Table of Contents</strong></a></p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="toc-entry-1">Overview</a></li>
<li><a class="reference internal" href="#documentation" id="toc-entry-2">Documentation</a></li>
<li><a class="reference internal" href="#installation" id="toc-entry-3">Installation</a></li>
<li><a class="reference internal" href="#examples" id="toc-entry-4">Examples</a><ul>
<li><a class="reference internal" href="#most-basic-one" id="toc-entry-5">Most Basic One</a></li>
</ul>
</li>
<li><a class="reference internal" href="#related-tools" id="toc-entry-6">Related Tools</a><ul>
<li><a class="reference internal" href="#included-with-rustup" id="toc-entry-7">Included with rustup</a></li>
<li><a class="reference internal" href="#external-ecosystem" id="toc-entry-8">External Ecosystem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-advanced-topics" id="toc-entry-9">More Advanced Topics</a></li>
<li><a class="reference internal" href="#mode-of-operation" id="toc-entry-10">Mode of Operation</a></li>
<li><a class="reference internal" href="#quick-facts" id="toc-entry-11">Quick Facts</a></li>
<li><a class="reference internal" href="#language-bindings" id="toc-entry-12">Language Bindings</a></li>
<li><a class="reference internal" href="#short-hints" id="toc-entry-13">Short Hints</a><ul>
<li><a class="reference internal" href="#optimizing-for-native-cpu-platform" id="toc-entry-14">Optimizing for native CPU platform</a></li>
<li><a class="reference internal" href="#accelerating-builds" id="toc-entry-15">Accelerating Builds</a></li>
</ul>
</li>
<li><a class="reference internal" href="#micro-cheat-sheet" id="toc-entry-16">Micro-Cheat Sheet</a></li>
<li><a class="reference internal" href="#rust-resources" id="toc-entry-17">Rust Resources</a></li>
</ul>
</div>
<p><span class="raw-html"></center></span></p>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#toc-entry-1">Overview</a></h1>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Rust_(programming_language)">Rust</a>  is a multi-paradigm, general-purpose, efficient, safe language available as free software; see <a class="reference external" href="https://www.rust-lang.org/">its official website</a> for more details.</p>
</div>
<div class="section" id="documentation">
<h1><a class="toc-backref" href="#toc-entry-2">Documentation</a></h1>
<p>One should read the official <a class="reference external" href="https://doc.rust-lang.org/stable/book/">Rust book</a> (<em>The Rust Programming Language</em>), which is clear and well written.</p>
<p>See also:</p>
<ul class="simple">
<li><a class="reference external" href="https://wiki.archlinux.org/title/rust">Rust on Arch Linux</a></li>
</ul>
</div>
<div class="section" id="installation">
<span id="rust-installation"></span><h1><a class="toc-backref" href="#toc-entry-3">Installation</a></h1>
<p>Even if done here in the context of Arch Linux, for the procedure that we recommend the actual distribution does not matter.</p>
<p>As we intend to develop (rather than just running or installing Rust software), we prefer relying on the Rustup toolchain manager, so that multiple toolchains, for multiple platforms and architectures, can be used.</p>
<p>Rather than using <tt class="docutils literal">pacman</tt> to install its <tt class="docutils literal">rustup</tt> package, we prefer going the more standard Rust way. One should follow the official <a class="reference external" href="https://rustup.rs/">Rust guidelines</a> for that; here is our corresponding procedure:</p>
<pre class="code bash literal-block">
$<span class="w"> </span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">'=https'</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span>&gt;<span class="w"> </span>install-rustup.sh<span class="w">
</span><span class="c1"># Inspect install-rustup.sh before running it.
</span>$<span class="w"> </span>sh<span class="w"> </span>install-rustup.sh
</pre>
<p>From now the <tt class="docutils literal">rustc</tt> compiler and the Cargo package manager are available on the system, from one's account (in the <tt class="docutils literal"><span class="pre">~/.rustup</span></tt> and <tt class="docutils literal"><span class="pre">~/.cargo</span></tt> trees respectively). All Rust-related commands are then be available from <tt class="docutils literal"><span class="pre">~/.cargo/bin</span></tt>.</p>
<p>One may prefer customising the installation and avoiding that one's shell configuration is automatically modified; then it is just a matter of editing typically one's <tt class="docutils literal"><span class="pre">~/.bashrc</span></tt> or related by oneself and adding there <tt class="docutils literal">export <span class="pre">PATH=&quot;${HOME}/.cargo/bin:${PATH}&quot;</span></tt> (another option is to add <tt class="docutils literal">. <span class="pre">${HOME}/.cargo/env</span></tt> instead).</p>
<p>Then updating the current shell accordingly (e.g. <tt class="docutils literal">. <span class="pre">~/.bashrc</span></tt>) allows to check that for example <tt class="docutils literal">rustc</tt> can now be executed as intended.</p>
<p>As Rust does not perform the linking by itself, a linker (typically provided by <tt class="docutils literal">gcc</tt>) must be available.</p>
<p>Afterwards Rust may be updated thanks to <tt class="docutils literal">rustup update</tt>.</p>
<p>Should some day Rust and rustup have to be uninstalled, run <tt class="docutils literal">rustup self uninstall</tt>.</p>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#toc-entry-4">Examples</a></h1>
<div class="section" id="most-basic-one">
<h2><a class="toc-backref" href="#toc-entry-5">Most Basic One</a></h2>
<p>In <tt class="docutils literal">~/hello.rs</tt>:</p>
<pre class="code rust literal-block">
<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Hello from Ceylan-HOWTOs!&quot;</span><span class="p">);</span><span class="w">
</span><span class="p">}</span>
</pre>
<p>One may notice the use of a macro (<tt class="docutils literal">!</tt> suffix), and that most lines of Rust code end with a semicolon (<tt class="docutils literal">;</tt>).</p>
<p>To be compiled and linked with <tt class="docutils literal">rustc hello.rs</tt> and run with <tt class="docutils literal">./hello</tt>; yields as expected: <tt class="docutils literal">Hello from <span class="pre">Ceylan-HOWTOs!</span></tt>.</p>
<p>This executable occupies 3.7MB (!); more information:</p>
<pre class="code bash literal-block">
$<span class="w"> </span>file<span class="w"> </span>hello<span class="w">
</span>hello:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>pie<span class="w"> </span>executable,<span class="w"> </span>x86-64,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>SYSV<span class="o">)</span>,<span class="w"> </span>dynamically<span class="w"> </span>linked,<span class="w"> </span>interpreter<span class="w"> </span>/lib64/ld-linux-x86-64.so.2,<span class="w">
</span>BuildID<span class="o">[</span>sha1<span class="o">]=</span>c77ef3f032c2f1961866e0889d54d6342a9e3554,<span class="w"> </span><span class="k">for</span><span class="w"> </span>GNU/Linux<span class="w"> </span><span class="m">4</span>.4.0,<span class="w"> </span>with<span class="w"> </span>debug_info,<span class="w"> </span>not<span class="w"> </span>stripped
</pre>
<p>No need to devise one's GNU make automatic rules - cargo will do best.</p>
</div>
</div>
<div class="section" id="related-tools">
<h1><a class="toc-backref" href="#toc-entry-6">Related Tools</a></h1>
<div class="section" id="included-with-rustup">
<h2><a class="toc-backref" href="#toc-entry-7">Included with rustup</a></h2>
<div class="section" id="cargo">
<h3>Cargo</h3>
<p><a class="reference external" href="https://crates.io/">Cargo</a> is the Rust integrated dependency manager and build tool.</p>
<p>In Rust, a package of code is referred to as a <em>crate</em>. So Cargo is the build system and package manager of choice to access Rust communityâ€™s crate registry.</p>
<p>More precisely, Cargo allows installing crates and publishing ones, so that Rust projects can declare their various dependencies and so that their build is repeatable. See also the <a class="reference external" href="https://doc.rust-lang.org/cargo/guide/">Cargo guide</a>.</p>
<p>For its configuration, Cargo relies on a <tt class="docutils literal">Cargo.toml</tt> manifest file, placed at the root of the tree of the package it applies to.</p>
<p>Its format is named TOML (<em>Tom's Obvious, Minimal Language</em>), and the various keys that it introduces <a class="reference external" href="https://doc.rust-lang.org/cargo/reference/manifest.html">are listed here</a>.</p>
</div>
<div class="section" id="rustfmt">
<h3>Rustfmt</h3>
<p><a class="reference external" href="https://github.com/rust-lang/rustfmt">Rustfmt</a> is the source-formatting tool of choice: it formats Rust code according to the official style guidelines <a class="footnote-reference" href="#footnote-1" id="footnote-reference-1">[1]</a>.</p>
<table class="docutils footnote" frame="void" id="footnote-1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-1">[1]</a></td><td>e.g. indent with four spaces - not tabs; place the curly braces according to this convention, etc.</td></tr>
</tbody>
</table>
<p>We found very useful that a stable, conventional formatting exists, and decided from the start to systematically use it. This allows a great standardization of sources, for easier readings and simplified merges.</p>
<p>Rustfmt should be readily available with <tt class="docutils literal">rustup</tt>; otherwise execute <tt class="docutils literal">rustup component add rustfmt</tt>.</p>
</div>
</div>
<div class="section" id="external-ecosystem">
<h2><a class="toc-backref" href="#toc-entry-8">External Ecosystem</a></h2>
<div class="section" id="rust-analyzer">
<h3>rust-analyzer</h3>
<p>This is a Language Server Protocol implementation for Rust, typically used by IDEs.</p>
<p>There are multiple <a class="reference external" href="https://rust-analyzer.github.io/manual.html#installation">options to install it</a>; rather than installing as an (OS) package, we prefer once again using <tt class="docutils literal">rustup</tt>, with: <tt class="docutils literal">rustup component add <span class="pre">rust-analyzer</span></tt>.</p>
<p>Once installed, running <tt class="docutils literal"><span class="pre">rust-analyzer</span> <span class="pre">--version</span></tt> should switch from:</p>
<pre class="literal-block">
error: Unknown binary 'rust-analyzer' in official toolchain 'stable-x86_64-unknown-linux-gnu'.
</pre>
<p>to something like:</p>
<pre class="literal-block">
rust-analyzer 1.76.0 (07dca48 2024-02-04)
</pre>
<p>As rust-analyzer will need the Rust source code, the latter can be directly installed with: <tt class="docutils literal">rustup component add <span class="pre">rust-src</span></tt>.</p>
</div>
<div class="section" id="using-emacs-with-rust">
<h3>Using Emacs with Rust</h3>
<p>The Emacs light-weight <a class="reference external" href="https://github.com/rust-lang/rust-mode">rust-mode</a> can be used, yet <a class="reference external" href="https://github.com/brotzeit/rustic">rustic</a> (which is based on <tt class="docutils literal"><span class="pre">rust-mode</span></tt>) provides additional features that we like.</p>
<p>A prerequisite thereof is <a class="reference internal" href="#rust-analyzer">rust-analyzer</a> (and of course a recent Emacs).</p>
</div>
<div class="section" id="base-approach">
<h3>Base Approach</h3>
<p>One may rely on <a class="reference external" href="https://github.com/radian-software/straight.el">straight.el</a> to manage one's Emacs packages (as a replacement for the Emacs now built-in <tt class="docutils literal">package.el</tt>), so, provided that the <a class="reference external" href="https://github.com/radian-software/straight.el?tab=readme-ov-file#getting-started">straight.el bases</a> are respected, having <tt class="docutils literal">rustic</tt> is just a matter of adding, typically  in one's <tt class="docutils literal"><span class="pre">~/.emacs.d/init.el</span></tt>, a <tt class="docutils literal"><span class="pre">(straight-use-package</span> 'rustic)</tt> line.</p>
</div>
<div class="section" id="more-involved-approach">
<h3>More Involved Approach</h3>
<p>We prefer installing and configuring <tt class="docutils literal">rustic</tt> with <tt class="docutils literal"><span class="pre">use-package</span> rustic</tt>, as done in <a class="reference external" href="https://robert.kra.hn/posts/rust-emacs-setup/">Robert Krahn's page</a>; see <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/init.el">our complete init.el</a> for that.</p>
<p>Then opening a Rust source file (e.g. <tt class="docutils literal">hello.rs</tt>) should automatically exhibit syntax highlighting and the <tt class="docutils literal">Rustic</tt> mode.</p>
<p>Notably, saving a Rust source file will automatically format it with <a class="reference external" href="https://github.com/rust-lang/rustfmt">Rustfmt</a>, which is neat.</p>
<p>See also:</p>
<ul class="simple">
<li>the <a class="reference external" href="https://wikemacs.org/wiki/Rust">WikEmacs page</a></li>
<li>the <a class="reference external" href="https://robert.kra.hn/posts/rust-emacs-setup/">Robert Krahn's page about it</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="more-advanced-topics">
<h1><a class="toc-backref" href="#toc-entry-9">More Advanced Topics</a></h1>
</div>
<div class="section" id="mode-of-operation">
<h1><a class="toc-backref" href="#toc-entry-10">Mode of Operation</a></h1>
<p>Rust relies on LLVM to generate its code, in order to be platform and hardware-agnostic, and to achieve best performance.</p>
</div>
<div class="section" id="quick-facts">
<h1><a class="toc-backref" href="#toc-entry-11">Quick Facts</a></h1>
<ul class="simple">
<li>Rust is well suited for <strong>embedded development</strong>, because it can target many platforms (thanks to LLVM) and can be as low-level as wanted; notably using <tt class="docutils literal"><span class="pre">#![no_std]</span></tt> allows to benefit from the <em>Rust Core Library</em> without relying on the <em>Rust Standard Library</em>, for smaller binary sizes and possibly improved performance</li>
<li>thanks to the use of rustup and its support of toolchains, <strong>cross-compiling</strong> is rather easy; for instance, to install Rust using the stable channel for Windows, using the GNU Compiler, just execute <tt class="docutils literal">rustup toolchain install <span class="pre">stable-x86_64-pc-windows-gnu</span></tt></li>
</ul>
</div>
<div class="section" id="language-bindings">
<h1><a class="toc-backref" href="#toc-entry-12">Language Bindings</a></h1>
</div>
<div class="section" id="short-hints">
<h1><a class="toc-backref" href="#toc-entry-13">Short Hints</a></h1>
<div class="section" id="optimizing-for-native-cpu-platform">
<h2><a class="toc-backref" href="#toc-entry-14">Optimizing for native CPU platform</a></h2>
<p>The current target platform is given by <tt class="docutils literal">rustup toolchain list</tt>; in our case it is <tt class="docutils literal"><span class="pre">stable-x86_64-unknown-linux-gnu</span></tt>.</p>
<p>Then, to request Cargo to always compile code optimized for the native CPU platform, one may add in <tt class="docutils literal"><span class="pre">~/.cargo/config</span></tt>:</p>
<pre class="literal-block">
[target.x86_64-unknown-linux-gnu]
rustflags = [&quot;-C&quot;, &quot;target-cpu=native&quot;]
</pre>
<p>Note that the resulting binary is expected to depend on the precise local CPU and thus should not be distributed - lest it cannot be run on other computers.</p>
</div>
<div class="section" id="accelerating-builds">
<h2><a class="toc-backref" href="#toc-entry-15">Accelerating Builds</a></h2>
<p>A shared compilation cache - specifically <a class="reference external" href="https://github.com/mozilla/sccache">sccache</a> may be used to speed up builds.</p>
<p>See <a class="reference external" href="https://wiki.archlinux.org/title/rust#sccache">this section</a> for more details.</p>
</div>
</div>
<div class="section" id="micro-cheat-sheet">
<h1><a class="toc-backref" href="#toc-entry-16">Micro-Cheat Sheet</a></h1>
<ul class="simple">
<li>to get Rust (compiler) version: <tt class="docutils literal">rustc <span class="pre">-V</span></tt>; for cargo: <tt class="docutils literal">cargo <span class="pre">--version</span></tt></li>
<li>to create a binary (application) <cite>my_project</cite> package: <tt class="docutils literal">cargo new my_project</tt>; Git files will be generated iff not already in a clone</li>
</ul>
</div>
<div class="section" id="rust-resources">
<h1><a class="toc-backref" href="#toc-entry-17">Rust Resources</a></h1>
<ul class="simple">
<li>the reference is the <a class="reference external" href="http://erlang.org">Rust official website</a></li>
</ul>
<p><span class="raw-html"><a name="howtos_bottom"></a></span></p>
</div>
</div>
</body>
</html>
